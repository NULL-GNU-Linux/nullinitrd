#!/bin/sh
# hooks/resume

if [ -z "$NULLINITRD_WORKDIR" ]; then
    echo "Error: NULLINITRD_WORKDIR not set"
    exit 1
fi

WORKDIR="$NULLINITRD_WORKDIR"

INIT_FILE="$WORKDIR/init"

if [ ! -f "$INIT_FILE" ]; then
    echo "Error: init file not found"
    exit 1
fi

RESUME_LINE='
RESUME_DEV=$(cat /sys/power/resume 2>/dev/null)
if [ -n "$RESUME_DEV" ] && [ -e "/sys/power/resume" ]; then
    echo "Attempting resume from hibernation..."
    echo $RESUME_DEV > /sys/power/resume
fi
'

sed -i '/mount -t devtmpfs/a\'"$RESUME_LINE" "$INIT_FILE"
